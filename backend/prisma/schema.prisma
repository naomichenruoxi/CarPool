generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  id                 String              @id @default(uuid())
  email              String              @unique
  name               String?
  isDriver           Boolean             @default(false)
  createdAt          DateTime            @default(now())
  
  personalityProfile PersonalityProfile?
  tripsAsDriver      Trip[]              @relation("DriverTrips")
  bookings           Booking[]
  
  ratingsReceived    Rating[]            @relation("ReceivedRatings")
  ratingsGiven       Rating[]            @relation("GivenRatings")
  messagesSent       Message[]
}

model PersonalityProfile {
  id              Int     @id @default(autoincrement())
  userId          String  @unique
  bio             String?
  talkativeness   Int     @default(3) // 1 to 5
  musicPreference String?
  smokingAllowed  Boolean @default(false)
  petsAllowed     Boolean @default(false)
  
  hometown        String?
  workplace       String?
  languages       String?
  
  user            User    @relation(fields: [userId], references: [id])
}

model Trip {
  id              Int       @id @default(autoincrement())
  driverId        String
  origin          String
  destination     String
  originLat       Float?
  originLng       Float?
  destinationLat  Float?
  destinationLng  Float?
  departureTime   DateTime
  availableSeats  Int
  pricePerSeat    Float
  createdAt       DateTime  @default(now())

  driver          User      @relation("DriverTrips", fields: [driverId], references: [id])
  bookings        Booking[]
  
  // Relations for ratings logic if ratings are per-trip
  ratings         Rating[]
}

model Booking {
  id        Int      @id @default(autoincrement())
  tripId    Int
  passengerId String
  status    BookingStatus @default(PENDING)
  createdAt DateTime @default(now())
  respondedAt DateTime?

  trip      Trip     @relation(fields: [tripId], references: [id])
  passenger User     @relation(fields: [passengerId], references: [id])
  
  status    String   @default("PENDING") // PENDING, APPROVED, REJECTED, CANCELLED
  messages  Message[]
}

model Message {
  id        Int      @id @default(autoincrement())
  content   String
  senderId  String
  bookingId Int
  createdAt DateTime @default(now())

  sender    User     @relation(fields: [senderId], references: [id])
  booking   Booking  @relation(fields: [bookingId], references: [id], onDelete: Cascade)
}

enum BookingStatus {
  PENDING
  ACCEPTED
  REJECTED
  CANCELED
}

model Rating {
  id            Int      @id @default(autoincrement())
  raterId       String
  ratedUserId   String
  tripId        Int?     // Optional context
  score         Int      // 1-5
  comment       String?
  createdAt     DateTime @default(now())

  rater         User     @relation("GivenRatings", fields: [raterId], references: [id])
  ratedUser     User     @relation("ReceivedRatings", fields: [ratedUserId], references: [id])
  trip          Trip?    @relation(fields: [tripId], references: [id])
}
